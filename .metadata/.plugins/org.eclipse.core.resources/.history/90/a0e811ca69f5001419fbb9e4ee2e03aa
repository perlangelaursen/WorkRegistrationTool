//Anna ï¿½lgaard Nielsen - s144437

package apptest;

import static org.junit.Assert.*;
import java.util.Calendar;
import java.util.GregorianCalendar;
import org.junit.Before;
import org.junit.Test;
import softwarehuset.*;

public class TestAssignProjectLeader {
	/**
	 * Tests the scenario where a project is assigned a projectleader
	 * <ol>
	 * <li>Projectleader is assigned
	 * </ol>
	 * @throws OperationNotAllowedException 
	 */
	
	private Address address;
	private Company company;
	private Executive executive;
	private GregorianCalendar startDate, endDate;
	private Employee employee;
	private Project project;
	
	@Before
	public void setUp() throws OperationNotAllowedException {
		address = new Address("City", "Street", 1);
		company = new Company("SoftwareHuset", address);
		executive = new Executive("name","Department1", company, "password");
		employee = company.createEmployee("ANDE", "password", "Project Department");
		startDate = new GregorianCalendar();
		endDate = new GregorianCalendar();
		startDate.add(Calendar.YEAR, 2015);
		endDate.add(Calendar.YEAR, 2015);
	}
	
	@Test
	public void testAssignProjectLeader() throws OperationNotAllowedException {
		//Check for executive is logged in
		assertFalse(company.executiveIsLoggedIn());
		company.executiveLogin("password");
		assertTrue(company.executiveIsLoggedIn());
		
		//The project ID is set to 150001 automatically (first project in year '15)
		company.createProject("Project 1", startDate, endDate);
		project = company.getProject("Project 1");
		//Check for company is implemented properly
		assertEquals(company.getProjects().size(), 1);
		
		project = company.getProject(150001);
		executive.assignProjectLeader("ANDE", project.getID());
		assertEquals(project.getProjectLeader(), employee);
	}

	@Test
	public void testNotLoggedIn() throws OperationNotAllowedException {
		//Catch exception when executive not logged in
		try {
			executive.assignProjectLeader("ANDE", project.getID());
			fail("OperationNotAllowedOperationNotAllowedException OperationNotAllowedException should have been thrown");
		} catch (OperationNotAllowedException e) {
			assertEquals("Assign project leader is not allowed if not executive", e.getMessage());
			assertEquals("Assign project leader", e.getOperation());
		}
	}
	
	@Test
	public void testEmployeeNotFound() throws OperationNotAllowedException {
		assertFalse(com.executiveIsLoggedIn());
		com.executiveLogin("password");
		assertTrue(com.executiveIsLoggedIn());
		
		com.createProject("p1", d1, d2);
		Project p1 = com.getProject("p1");
		assertEquals(com.getProjects().size(),1);
		
		try {
			ex.assignProjectLeader("ENDE", p1.getID());
			fail("OperationNotAllowedException expected");
		} catch(OperationNotAllowedException e) {
			assertEquals("Employee not found", e.getMessage());
			assertEquals("Get employee", e.getOperation());
		}
	}

	@Test
	public void testProjectNotFound() throws OperationNotAllowedException {
		com.executiveLogin("password");
		try {
			ex.assignProjectLeader("em", 150502);
			fail("OperationNotAllowedException expected");
		} catch(OperationNotAllowedException e) {
			assertEquals("Employee not found", e.getMessage());
			assertEquals("Get employee", e.getOperation());
		}
	}

	@Test
	public void testChangeProjectLeader() throws OperationNotAllowedException {
		assertFalse(com.executiveIsLoggedIn());
		com.executiveLogin("password");
		assertTrue(com.executiveIsLoggedIn());
		com.createProject("p1", d1, d2);
		Project p1 = com.getProject("p1");
		assertEquals(com.getProjects().size(),1);
		ex.assignProjectLeader("ANDE", p1.getID());
		assertEquals(p1.getProjectLeader(), em);
		Employee em2 = com.createEmployee("KAND", "password", "Project 2 Department");
		ex.assignProjectLeader("KAND", p1.getID());
		assertEquals(p1.getProjectLeader(), em2);
	}
}